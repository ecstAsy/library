---
title: Webpackå­¦ä¹ ç¬”è®°
author: ecstAsy
date: "2022-01-04"
---

### npm install

**_npm install --save:_** ç”ŸæˆçŽ¯å¢ƒçš„ä¾èµ–åŒ…
**_npm install --save-dev:_** å¼€å‘çŽ¯å¢ƒä¾èµ–åŒ…

å½“åœ¨ windows ä¸­é€šè¿‡è°ƒç”¨è·¯å¾„åŽ»è°ƒç”¨ webpack æ—¶ï¼Œå¿…é¡»ä½¿ç”¨åæ–œçº¿();

webpack ä¸­çš„åè¯è§£æžï¼š

æˆ‘ä»¬å¯ä»¥é€šè¿‡é…ç½®æ–¹å¼æŒ‡å®š loader
**_è§„åˆ™(loader rules)_**ã€
**_æ’ä»¶(plugins)_**ã€
**_è§£æžé€‰é¡¹(resolve options)_** ï¼Œ
ä»¥åŠè®¸å¤šå…¶ä»–å¢žå¼ºåŠŸèƒ½ã€‚

### **loader**

- style-loader
- css-loader
- file-loader
- ts-loader
- js-loader

### **source-map**

**_source-map_** : ä¸€ç§æä¾› **æºä»£ç åˆ°æž„å»ºåŽä»£ç æ˜ å°„** æŠ€æœ¯ï¼ˆå¦‚æžœæž„å»ºåŽä»£ç å‡ºé”™äº†ï¼Œé€šè¿‡æ˜ å°„å¯ä»¥è¿½è¸ªæºä»£ç é”™è¯¯ä½ç½®ï¼‰

:::tip

**æœ‰æ•ˆå€¼**

[inline-|hidden-|eval-][nosources-][cheap-[module-]]source-map

:::

- **source-map**
  - å¤–éƒ¨
  - é”™è¯¯ä»£ç å‡†ç¡®ä¿¡æ¯
  - æºä»£ç çš„é”™è¯¯ä½ç½®
- **inline-source-map**
  - å†…è”
  - åªç”Ÿæˆä¸€ä¸ªå†…è” source-map
  - é”™è¯¯ä»£ç å‡†ç¡®ä¿¡æ¯
  - æºä»£ç çš„é”™è¯¯ä½ç½®
- **hidden-source-map**
  - å¤–éƒ¨
  - é”™è¯¯ä»£ç é”™è¯¯åŽŸå› ï¼Œä½†æ˜¯æ²¡æœ‰é”™è¯¯ä½ç½®
  - ä¸èƒ½è¿½è¸ªæºä»£ç é”™è¯¯ï¼Œåªèƒ½æç¤ºåˆ°æž„å»ºåŽä»£ç çš„é”™è¯¯ä½ç½®
- **eval-source-map**
  - å†…è”
  - æ¯ä¸€ä¸ªæ–‡ä»¶éƒ½ç”Ÿæˆå¯¹åº”çš„ source-mapï¼Œéƒ½åœ¨ eval
  - é”™è¯¯ä»£ç å‡†ç¡®ä¿¡æ¯
  - æºä»£ç çš„é”™è¯¯ä½ç½®
- **nosources-source-map**
  - å¤–éƒ¨
  - é”™è¯¯ä»£ç é”™è¯¯åŽŸå› ï¼Œä½†æ˜¯æ²¡æœ‰ä»»ä½•æºä»£ç ä¿¡æ¯
- **cheap-source-map**
  - å¤–éƒ¨
  - é”™è¯¯ä»£ç é”™è¯¯ä¿¡æ¯
  - æºä»£ç çš„é”™è¯¯ä½ç½®ï¼ˆåªèƒ½ç²¾ç¡®åˆ°è¡Œï¼‰
- **cheap-module-source-map**
  - å¤–éƒ¨
  - é”™è¯¯ä»£ç é”™è¯¯ä¿¡æ¯
  - æºä»£ç çš„é”™è¯¯ä½ç½®
  - module ä¼šå°† loader çš„ source-map åŠ å…¥

**å†…è”å’Œå¤–éƒ¨çš„åŒºåˆ«**ï¼š

- å¤–éƒ¨ç”Ÿæˆäº†æ–‡ä»¶ã€å†…è”æ²¡æœ‰
- å†…è”æž„å»ºé€Ÿåº¦æ›´å¿«

**å¦‚ä½•é€‰æ‹©**

å¼€å‘çŽ¯å¢ƒ **é€Ÿåº¦å¿«ã€è°ƒè¯•æ›´åŠ å‹å¥½**

- é€Ÿåº¦å¿« ï¼ˆ**_eval > inline > cheap > ..._**ï¼‰
  - **eval-cheap-source-map**
  - **eval-source-map**
- è°ƒè¯•æ›´åŠ å‹å¥½
  - **source-map**
  - **cheap-module-source-map**
  - **cheap-source-map**

---

**_æ€»ç»“_** : **_eval-source-map_** / **_eval-cheap-module-source-map_**

ç”Ÿäº§çŽ¯å¢ƒ **æºä»£ç è¦ä¸è¦éšè—ã€è°ƒè¯•è¦ä¸è¦æ›´å‹å¥½**

> å†…è”ä¼šè®©ä»£ç ä½“ç§¯å˜å¤§ï¼Œæ‰€ä»¥åœ¨ç”Ÿäº§çŽ¯å¢ƒä¸ç”¨å†…è”

- **nosources-source-map** å…¨éƒ¨éšè—
- **hidden-source-map** åªéšè—æž„å»ºåŽçš„ä»£ç ï¼Œä¼šæç¤ºæž„å»ºåŽä»£ç é”™è¯¯ä¿¡æ¯

**_æ€»ç»“_** : **_source-map_** / **_cheap-module-source-map_**

#### ç¼“å­˜

- **babel ç¼“å­˜**
  ```json
  { "cacheDirectory": true }
  ```
  è®©ç¬¬äºŒæ¬¡æ‰“åŒ…æž„å»ºé€Ÿåº¦æ›´å¿«
- æ–‡ä»¶èµ„æºç¼“å­˜

  - **hash**: æ¯æ¬¡ webpack æž„å»ºæ—¶ä¼šç”Ÿæˆä¸€ä¸ªå”¯ä¸€çš„ hash å€¼

    **é—®é¢˜ ðŸ¤”ï¸**ï¼šå› ä¸º js å’Œ css åŒæ—¶ä½¿ç”¨ä¸€ä¸ª hash å€¼ï¼Œå¦‚æžœé‡æ–°æ‰“åŒ…ï¼Œä¼šå¯¼è‡´æ‰€æœ‰ç¼“å­˜å¤±æ•ˆã€‚ï¼ˆå¯èƒ½æˆ‘ä»¬åªä¿®æ”¹ä¸€ä¸ªæ–‡ä»¶ï¼‰

  - **chunkhash** : æ ¹æ® chunk ç”Ÿæˆçš„ hash å€¼ï¼Œå¦‚æžœæ‰“åŒ…æ¥æºåŒä¸€ä¸ª chunkï¼Œ é‚£ä¹ˆ hash å€¼å°±ä¸€æ ·

    **é—®é¢˜ ðŸ¤”ï¸**ï¼šjs å’Œ css çš„ hash å€¼è¿˜æ˜¯ä¸€æ ·çš„ï¼Ÿ

    **å› ä¸º css æ˜¯åœ¨ js ä¸­è¢«å¼•å…¥çš„ï¼Œæ‰€ä»¥åŒå±žä¸€ä¸ª chunk,æ‰€ä»¥ js å’Œ css çš„ hash å€¼æ˜¯ä¸€æ ·çš„**

  - **contenthash** : æ ¹æ®æ–‡ä»¶çš„å†…å®¹ç”Ÿæˆ hash å€¼ï¼Œä¸åŒæ–‡ä»¶ hash å€¼ä¸€å®šä¸ä¸€æ ·

  è®©ä»£ç ä¸Šçº¿è¿è¡Œç¼“å­˜æ›´å¥½ä½¿ç”¨

#### **tree shaking**

- ç›®çš„ï¼š**åŽ»é™¤æ— ç”¨ä»£ç **
- å‰æ
  - å¿…é¡»ä½¿ç”¨ ES6 æ¨¡å—åŒ–
  - å¼€å¯ production çŽ¯å¢ƒ
- ä½œç”¨ï¼š **å‡å°‘ä»£ç ä½“ç§¯**

åœ¨ `package.json` ä¸­é…ç½®

`"sideEffects": false` ï¼šåˆ™æ‰€æœ‰ä»£ç éƒ½æ²¡æœ‰å‰¯ä½œç”¨ï¼ˆéƒ½å¯ä»¥è¿›è¡Œ tree shakingï¼‰

é—®é¢˜ï¼šå¯èƒ½ä¼šæŠŠ css / @babel/polyfill (å‰¯ä½œç”¨)æ–‡ä»¶å¹²æŽ‰

`"sideEffects": ["*.css", "*.less"]`

#### **code split** ä»£ç åˆ†å‰²

- å•å…¥å£æ”¹æˆå¤šå…¥å£
- **optimization**

  - **å¯ä»¥å°† node_modules ä¸­çš„ä»£ç å•ç‹¬æ‰“åŒ…æˆä¸€ä¸ª chunk æœ€ç»ˆè¾“å‡º**
  - è‡ªåŠ¨åˆ†æžå¤šå…¥å£ chunk ä¸­æœ‰æ²¡æœ‰å…¬å…±çš„æ–‡ä»¶ï¼ˆ10k +ï¼‰ï¼Œå¦‚æžœæœ‰ä¼šæ‰“åŒ…æˆå•ç‹¬çš„ä¸€ä¸ª chunk

  ```json
  optimization: {
    splitChunks: {
      chunks: "all";
    }
  }
  ```

- é€šè¿‡ js ä»£ç ï¼Œè®©æŸä¸ªæ–‡ä»¶è¢«å•ç‹¬æ‰“åŒ…æˆä¸€ä¸ª chunk

  import åŠ¨æ€å¯¼å…¥è¯­æ³•ï¼šèƒ½å°†æŸä¸ªæ–‡ä»¶å•ç‹¬æ‰“åŒ…

```js
import(/* webpackChunkName:"test" */ "./test")
  .then((result) => {
    console.log(result);
  })
  .catch(() => {
    console.log("æ–‡ä»¶åŠ è½½å¤±è´¥ï½ž");
  });
```
